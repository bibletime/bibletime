sudo: false
dist: trusty
language: cpp
compiler: gcc

branches:
  only:
    - master
    - master_coverity_scan
    - /^stable-.*$/

os:
  - linux

before_install:
  - export CC=${XCC}
  - export CXX=${XCXX}
  - source /opt/qt59/bin/qt59-env.sh
  - ./tests/scripts/install-sword.sh
  - export LD_LIBRARY_PATH=${HOME}/local/lib:$LD_LIBRARY_PATH

script:
  - if [ "0${COVERITY_SCAN_BRANCH}" != "01" ]; then mkdir b && cd b && cmake .. -DCMAKE_INSTALL_PREFIX=${HOME}/local && make -j4 && make install; fi

env:
  global:
     # The next declaration is the encrypted COVERITY_SCAN_TOKEN, created
     #   via the "travis encrypt" command using the project repo's public key
     - secure: "FmufrIN8L4Ptfbn0Lw/1S7fKnPxpvv7t9KEN5XhQ3lwW5Qir7mGe2r87biaKyjo15VNc4bizA2wR63YUXz6JPMETwYPahKSlW2tAsHmJTOwyweNW7zkKf6Iwrf9vYaMZyOpR2jRkD9Ko8vd4BpIw4FF6X/vaJqfnvQyIOiDGFr8="
  matrix:
    - XCC=gcc XCXX=g++
    - XCC=gcc-4.9 XCXX=g++-4.9
    - XCC=gcc-5 XCXX=g++-5
    - XCC=gcc-6 XCXX=g++-6
    - XCC=gcc-7 XCXX=g++-7
    - XCC=gcc-8 XCXX=g++-8
    - XCC=clang-4.0 XCXX=clang++-4.0
    - XCC=clang-5.0 XCXX=clang++-5.0
    - XCC=clang-6.0 XCXX=clang++-6.0

addons:
  coverity_scan:
    project:
      name: "bibletime/bibletime"
      description: "BibleTime build submitted via Travis CI"
    notification_email: bibletime-coverity@heh.ee
    build_command_prepend: "mkdir b && cd b && cmake .. -DCMAKE_INSTALL_PREFIX=${HOME}/local/"
    build_command: "cmake --build ."
    branch_pattern: .*_coverity_scan
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - sourceline: ppa:beineri/opt-qt595-trusty
      - sourceline: ppa:ubuntu-sdk-team/ppa
      - sourceline: deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-4.0 main
      - sourceline: deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-5.0 main
      - sourceline: deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main
        key_url: http://apt.llvm.org/llvm-snapshot.gpg.key
    packages:
      - cmake
      - libclucene-dev
      - qt59base
      - qt59declarative
      - qt59svg
      - qt59webengine
      - qt59xmlpatterns
      - qt59tools
      - gcc-4.9 g++-4.9
      - gcc-5 g++-5
      - gcc-6 g++-6
      - gcc-7 g++-7
      - gcc-8 g++-8
      - clang-4.0 clang++-4.0
      - clang-5.0 clang++-5.0
      - clang-6.0 clang++-6.0

notifications:
  irc: "chat.freenode.net#bibletime"
